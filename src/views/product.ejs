<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý danh sách nhạc</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-4">Quản lý danh sách nhạc</h1>
    <div class="card shadow mb-4">
      <div class="card-body">
        <!-- Form Thêm bài hát -->
        <h2 class="h4 mb-3">Thêm bài hát mới</h2>
        <form id="addProductForm" class="row g-3">
          <div class="col-md-6">
            <label for="title" class="form-label">Tên bài hát</label>
            <input type="text" class="form-control" id="title" placeholder="Nhập tên bài hát" required>
          </div>
          <div class="col-md-6">
            <label for="artist" class="form-label">Nghệ sĩ</label>
            <input type="text" class="form-control" id="artist" placeholder="Nhập tên nghệ sĩ" required>
          </div>
          <div class="col-12">
            <label for="audioUrl" class="form-label">Link bài hát</label>
            <input type="url" class="form-control" id="audioUrl" placeholder="Nhập URL bài hát" required>
          </div>
          <div class="col-12">
            <label for="lyrics" class="form-label">Lời bài hát</label>
            <textarea class="form-control" id="lyrics" rows="3" placeholder="Nhập lời bài hát" required></textarea>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Thêm bài hát</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Danh sách bài hát -->
    <div class="card shadow">
      <div class="card-body">
        <h2 class="h4 mb-3">Danh sách bài hát</h2>
        <ul class="list-group">
          <% products.forEach(product => { %>
            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-bold">
                  <%= product.title %> - <%= product.artist %>
                </div>
                <audio controls class="mt-2 w-100">
                  <source src="<%= product.audioUrl %>" type="audio/mp3">
                </audio>
                <p class="mt-2"><%= product.lyrics %></p>
              </div>
              <!-- Nút chức năng -->
              <div>
                <button class="btn btn-warning btn-sm mb-2" onclick="editProduct('<%= product._id %>')">Sửa</button>
                <button class="btn btn-danger btn-sm" onclick="deleteProduct('<%= product._id %>')">Xóa</button>
              </div>
            </li>
          <% }) %>
        </ul>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script>
    // Xử lý thêm bài hát
    document.getElementById('addProductForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const artist = document.getElementById('artist').value;
      const audioUrl = document.getElementById('audioUrl').value;
      const lyrics = document.getElementById('lyrics').value;

      try {
        const response = await fetch('/api/products', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, artist, audioUrl, lyrics })
        });
        const result = await response.json();
        if (response.ok) {
          alert('Thêm bài hát thành công!');
          location.reload();
        } else {
          alert(result.message || 'Lỗi khi thêm bài hát');
        }
      } catch (error) {
        console.error('Lỗi:', error);
      }
    });

    // Xử lý xóa bài hát
    async function deleteProduct(id) {
      if (confirm('Bạn có chắc chắn muốn xóa bài hát này?')) {
        try {
          const response = await fetch(`/api/products/${id}`, { method: 'DELETE' });
          if (response.ok) {
            alert('Xóa bài hát thành công!');
            location.reload();
          } else {
            alert('Lỗi khi xóa bài hát');
          }
        } catch (error) {
          console.error('Lỗi:', error);
        }
      }
    }

    // Xử lý sửa bài hát
    function editProduct(id) {
      const title = prompt('Nhập tên bài hát mới:');
      const artist = prompt('Nhập nghệ sĩ mới:');
      const audioUrl = prompt('Nhập link bài hát mới:');
      const lyrics = prompt('Nhập lời bài hát mới:');

      if (title && artist && audioUrl && lyrics) {
        fetch(`/api/products/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, artist, audioUrl, lyrics })
        })
          .then(response => {
            if (response.ok) {
              alert('Cập nhật bài hát thành công!');
              location.reload();
            } else {
              alert('Lỗi khi cập nhật bài hát');
            }
          })
          .catch(error => console.error('Lỗi:', error));
      }
    }
  </script>
</body>
</html>
